<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“† æœˆåº¦è®¡åˆ’çœ‹æ¿</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0f0f23;
            --bg-secondary: #1a1a2e;
            --bg-card: #16213e;
            --bg-hover: #1f3460;
            --accent-blue: #4facfe;
            --accent-purple: #a855f7;
            --accent-pink: #f472b6;
            --accent-green: #10b981;
            --accent-yellow: #fbbf24;
            --accent-orange: #fb923c;
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-color: #334155;
            --shadow-glow: 0 0 40px rgba(79, 172, 254, 0.15);
            --gradient-header: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-button: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans SC', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        /* èƒŒæ™¯æ•ˆæœ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(79, 172, 254, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(168, 85, 247, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(244, 114, 182, 0.05) 0%, transparent 70%);
            pointer-events: none;
            z-index: -1;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* å¤´éƒ¨ */
        header {
            background: var(--gradient-header);
            padding: 40px;
            border-radius: 24px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-glow);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 60%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(25deg);
        }

        header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            position: relative;
        }

        header p {
            font-size: 1rem;
            opacity: 0.9;
            position: relative;
        }

        /* å¹´åº¦ç›®æ ‡åŒºåŸŸ */
        .goals-section {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
        }

        .goals-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .goals-section h2 {
            font-size: 1.3rem;
            color: var(--accent-yellow);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-edit-goals {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-card);
            color: var(--text-secondary);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-edit-goals:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
            border-color: var(--accent-yellow);
        }

        .goals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }

        .goal-card {
            background: var(--bg-card);
            padding: 20px;
            border-radius: 16px;
            border-left: 4px solid var(--accent-blue);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .goal-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .goal-card.learning { border-left-color: var(--accent-blue); }
        .goal-card.exercise { border-left-color: var(--accent-green); }
        .goal-card.hobby { border-left-color: var(--accent-pink); }

        .goal-card h3 {
            font-size: 1rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .goal-card p {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* æ§åˆ¶é¢æ¿ */
        .control-panel {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
        }

        .control-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-group label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        select, input[type="text"], input[type="date"] {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 0.9rem;
            font-family: inherit;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        select:focus, input:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.2);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--gradient-button);
            color: #000;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(79, 172, 254, 0.4);
        }

        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--bg-hover);
        }

        .btn-danger {
            background: #dc2626;
            color: white;
        }

        .btn-danger:hover {
            background: #b91c1c;
        }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid var(--border-color);
            text-align: center;
        }

        .stat-card .stat-value {
            font-size: 2rem;
            font-weight: 700;
            background: var(--gradient-button);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-card .stat-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .stat-card.learning .stat-value { background: linear-gradient(135deg, #4facfe, #00f2fe); -webkit-background-clip: text; background-clip: text; }
        .stat-card.exercise .stat-value { background: linear-gradient(135deg, #10b981, #34d399); -webkit-background-clip: text; background-clip: text; }
        .stat-card.hobby .stat-value { background: linear-gradient(135deg, #f472b6, #ec4899); -webkit-background-clip: text; background-clip: text; }

        /* è®¡åˆ’åˆ—è¡¨ */
        .plans-section {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid var(--border-color);
        }

        .plans-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .plans-header h2 {
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .week-group {
            margin-bottom: 25px;
        }

        .week-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .week-header h3 {
            font-size: 1.1rem;
            color: var(--accent-purple);
        }

        .week-header .week-stats {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-left: auto;
        }

        .plan-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .plan-item {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 15px 20px;
            display: grid;
            grid-template-columns: auto 1fr auto auto auto;
            align-items: center;
            gap: 15px;
            transition: all 0.3s;
            border: 1px solid transparent;
        }

        .plan-item:hover {
            background: var(--bg-hover);
            border-color: var(--border-color);
        }

        .plan-item.completed {
            opacity: 0.6;
        }

        .plan-item.completed .plan-title {
            color: var(--text-muted);
        }

        .checkbox-wrapper {
            position: relative;
        }

        .checkbox-wrapper input {
            display: none;
        }

        .checkbox-wrapper label {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .checkbox-wrapper input:checked + label {
            background: var(--accent-green);
            border-color: var(--accent-green);
        }

        .plan-title {
            font-weight: 500;
        }

        .plan-date {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .type-tag {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .type-tag.learning {
            background: rgba(79, 172, 254, 0.2);
            color: var(--accent-blue);
        }

        .type-tag.exercise {
            background: rgba(16, 185, 129, 0.2);
            color: var(--accent-green);
        }

        .type-tag.hobby {
            background: rgba(244, 114, 182, 0.2);
            color: var(--accent-pink);
        }

        .type-tag.goal {
            background: rgba(251, 191, 36, 0.2);
            color: var(--accent-yellow);
        }

        .type-tag.other {
            background: rgba(251, 146, 60, 0.2);
            color: var(--accent-orange);
        }

        /* å¹´ä»½é€‰æ‹©å™¨ */
        .year-selector {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 20px;
            padding: 20px 30px;
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .year-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .year-label {
            font-size: 0.85rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .year-value {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 50%, #fb923c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 40px rgba(251, 191, 36, 0.3);
        }

        .year-nav {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 50%;
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .year-nav:hover {
            background: var(--gradient-button);
            color: #000;
            transform: scale(1.1);
        }

        .year-nav:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            transform: none;
        }

        .year-tabs {
            display: flex;
            gap: 10px;
            margin-left: 30px;
            padding-left: 30px;
            border-left: 1px solid var(--border-color);
        }

        .year-tab {
            padding: 8px 20px;
            border: 1px solid var(--border-color);
            border-radius: 25px;
            background: var(--bg-card);
            color: var(--text-secondary);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .year-tab:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .year-tab.active {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #000;
            border-color: transparent;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .year-selector {
                flex-direction: column;
                gap: 15px;
            }

            .year-tabs {
                margin-left: 0;
                padding-left: 0;
                border-left: none;
                padding-top: 15px;
                border-top: 1px solid var(--border-color);
            }

            .year-value {
                font-size: 2.5rem;
            }
        }

        .plan-actions {
            display: flex;
            gap: 8px;
        }

        .plan-actions button {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 8px;
            background: var(--bg-secondary);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .plan-actions button:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .plan-actions button.delete:hover {
            background: rgba(220, 38, 38, 0.2);
            color: #dc2626;
        }

        /* æ¨¡æ€æ¡† */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            border: 1px solid var(--border-color);
            transform: translateY(-20px);
            transition: transform 0.3s;
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal h2 {
            font-size: 1.3rem;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 12px 15px;
            border-radius: 10px;
            font-size: 0.95rem;
            font-family: inherit;
        }

        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 25px;
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }

        .empty-state .icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .empty-state h3 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: var(--text-secondary);
        }

        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            header {
                padding: 25px;
            }

            header h1 {
                font-size: 1.8rem;
            }

            .control-row {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-group {
                flex-direction: column;
                align-items: stretch;
            }

            .plan-item {
                grid-template-columns: auto 1fr;
                grid-template-rows: auto auto;
            }

            .plan-date, .type-tag, .plan-actions {
                grid-column: 2;
            }
        }

        /* åŠ¨ç”» */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-in {
            animation: fadeInUp 0.5s ease-out forwards;
        }

        .plan-item {
            animation: fadeInUp 0.3s ease-out forwards;
        }

        /* è¿›åº¦æ¡ */
        .progress-bar {
            height: 6px;
            background: var(--bg-card);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-bar .fill {
            height: 100%;
            background: var(--gradient-button);
            border-radius: 3px;
            transition: width 0.5s ease-out;
        }

        /* Toast é€šçŸ¥ */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease-out;
        }

        .toast.success {
            border-left: 4px solid var(--accent-green);
        }

        .toast.error {
            border-left: 4px solid #dc2626;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <header class="animate-in">
            <h1>ğŸ“† æœˆåº¦è®¡åˆ’çœ‹æ¿</h1>
            <p>è¿½è¸ªä½ çš„å­¦ä¹ ã€è¿åŠ¨å’Œå…´è¶£çˆ±å¥½è®¡åˆ’ | æœ¬åœ°æ•°æ®å­˜å‚¨</p>
        </header>

        <!-- å¹´ä»½é€‰æ‹©å™¨ -->
        <div class="year-selector animate-in" style="animation-delay: 0.05s">
            <button class="year-nav" id="prevYear" onclick="changeYear(-1)">â—€</button>
            <div class="year-display">
                <span class="year-label">å¹´åº¦è®¡åˆ’</span>
                <span class="year-value" id="currentYear">2025</span>
            </div>
            <button class="year-nav" id="nextYear" onclick="changeYear(1)">â–¶</button>
            <div class="year-tabs" id="yearTabs">
                <!-- åŠ¨æ€ç”Ÿæˆå¹´ä»½æ ‡ç­¾ -->
            </div>
        </div>

        <!-- å¹´åº¦ç›®æ ‡ -->
        <section class="goals-section animate-in" style="animation-delay: 0.1s">
            <div class="goals-header">
                <h2 id="goalsTitle">ğŸ¯ 2025 å¹´åº¦ç›®æ ‡</h2>
                <button class="btn-edit-goals" onclick="openGoalsModal()" title="ç¼–è¾‘å¹´åº¦ç›®æ ‡">âœï¸ ç¼–è¾‘</button>
            </div>
            <div class="goals-grid">
                <div class="goal-card learning">
                    <h3>ğŸ“š å­¦ä¹ è¾“å…¥</h3>
                    <p id="goalLearning">web3(æ¯å‘¨2h)ã€è‹±è¯­(æ¯å‘¨0.5h*2)ã€è¯»ä¹¦(æ¯å‘¨3h)ã€å†™ä½œä¸€ç¯‡(1h)</p>
                </div>
                <div class="goal-card exercise">
                    <h3>ğŸƒâ€â™€ï¸ è¿åŠ¨é”»ç‚¼</h3>
                    <p id="goalExercise">æ¯å‘¨è¿åŠ¨ 0.5h * 2 æ¬¡</p>
                </div>
                <div class="goal-card hobby">
                    <h3>ğŸµ å…´è¶£çˆ±å¥½</h3>
                    <p id="goalHobby">æ¯å‘¨ç»ƒä¹ 2hï¼Œå½•æ­Œä¸€é¦–</p>
                </div>
            </div>
        </section>

        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div class="stats-grid animate-in" style="animation-delay: 0.2s">
            <div class="stat-card">
                <div class="stat-value" id="totalPlans">0</div>
                <div class="stat-label">æ€»è®¡åˆ’æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="completedPlans">0</div>
                <div class="stat-label">å·²å®Œæˆ</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="completionRate">0%</div>
                <div class="stat-label">å®Œæˆç‡</div>
                <div class="progress-bar">
                    <div class="fill" id="progressFill" style="width: 0%"></div>
                </div>
            </div>
            <div class="stat-card learning">
                <div class="stat-value" id="learningCount">0</div>
                <div class="stat-label">ğŸ“š å­¦ä¹ ä»»åŠ¡</div>
            </div>
            <div class="stat-card exercise">
                <div class="stat-value" id="exerciseCount">0</div>
                <div class="stat-label">ğŸƒâ€â™€ï¸ è¿åŠ¨ä»»åŠ¡</div>
            </div>
            <div class="stat-card hobby">
                <div class="stat-value" id="hobbyCount">0</div>
                <div class="stat-label">ğŸµ å…´è¶£çˆ±å¥½</div>
            </div>
        </div>

        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="control-panel animate-in" style="animation-delay: 0.3s">
            <div class="control-row">
                <div class="filter-group">
                    <label>æœˆä»½:</label>
                    <select id="filterMonth">
                        <option value="">å…¨éƒ¨</option>
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </select>
                </div>
                <div class="filter-group">
                    <label>å‘¨:</label>
                    <select id="filterWeek">
                        <option value="">å…¨éƒ¨</option>
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </select>
                </div>
                <div class="filter-group">
                    <label>ç±»å‹:</label>
                    <select id="filterType">
                        <option value="">å…¨éƒ¨</option>
                        <option value="learning">ğŸ“š å­¦ä¹ è¾“å…¥</option>
                        <option value="exercise">ğŸƒâ€â™€ï¸ è¿åŠ¨é”»ç‚¼</option>
                        <option value="hobby">ğŸµ å…´è¶£çˆ±å¥½</option>
                        <option value="other">ğŸš— å…¶ä»–äº‹é¡¹</option>
                        <option value="goal">ğŸŒ² ç›®æ ‡è®¾å®š</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>çŠ¶æ€:</label>
                    <select id="filterStatus">
                        <option value="">å…¨éƒ¨</option>
                        <option value="completed">å·²å®Œæˆ</option>
                        <option value="pending">æœªå®Œæˆ</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="openAddModal()">
                    â• æ·»åŠ è®¡åˆ’
                </button>
                <button class="btn btn-secondary" onclick="exportData()">
                    ğŸ“¥ å¯¼å‡ºæ•°æ®
                </button>
                <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">
                    ğŸ“¤ å¯¼å…¥æ•°æ®
                </button>
                <input type="file" id="importFile" accept=".json" style="display: none" onchange="importData(event)">
            </div>
        </div>

        <!-- è®¡åˆ’åˆ—è¡¨ -->
        <section class="plans-section animate-in" style="animation-delay: 0.4s">
            <div class="plans-header">
                <h2>ğŸ“‹ è®¡åˆ’åˆ—è¡¨</h2>
                <span id="planCount" style="color: var(--text-muted); font-size: 0.9rem;"></span>
            </div>
            <div id="plansContainer">
                <!-- åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </section>
    </div>

    <!-- æ·»åŠ /ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="planModal">
        <div class="modal">
            <h2 id="modalTitle">â• æ·»åŠ æ–°è®¡åˆ’</h2>
            <form id="planForm" onsubmit="savePlan(event)">
                <input type="hidden" id="planId">
                <div class="form-group">
                    <label>è®¡åˆ’è¯¦æƒ… *</label>
                    <input type="text" id="planTitle" required placeholder="ä¾‹å¦‚ï¼šè‹±è¯­å­¦ä¹ ã€è·‘æ­¥">
                </div>
                <div class="form-group">
                    <label>æ—¥æœŸ *</label>
                    <input type="date" id="planDate" required onchange="updateMonthWeek()">
                </div>
                <div class="form-group">
                    <label>æœˆä»½ï¼ˆè‡ªåŠ¨è¯†åˆ«ï¼Œå¯ä¿®æ”¹ï¼‰</label>
                    <select id="planMonth">
                        <option value="1æœˆ">1æœˆ</option>
                        <option value="2æœˆ">2æœˆ</option>
                        <option value="3æœˆ">3æœˆ</option>
                        <option value="4æœˆ">4æœˆ</option>
                        <option value="5æœˆ">5æœˆ</option>
                        <option value="6æœˆ">6æœˆ</option>
                        <option value="7æœˆ">7æœˆ</option>
                        <option value="8æœˆ">8æœˆ</option>
                        <option value="9æœˆ">9æœˆ</option>
                        <option value="10æœˆ">10æœˆ</option>
                        <option value="11æœˆ">11æœˆ</option>
                        <option value="12æœˆ">12æœˆ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>å‘¨ï¼ˆè‡ªåŠ¨è¯†åˆ«ï¼Œå¯ä¿®æ”¹ï¼‰</label>
                    <select id="planWeek">
                        <option value="ç¬¬ä¸€å‘¨">ç¬¬ä¸€å‘¨</option>
                        <option value="ç¬¬äºŒå‘¨">ç¬¬äºŒå‘¨</option>
                        <option value="ç¬¬ä¸‰å‘¨">ç¬¬ä¸‰å‘¨</option>
                        <option value="ç¬¬å››å‘¨">ç¬¬å››å‘¨</option>
                        <option value="ç¬¬äº”å‘¨">ç¬¬äº”å‘¨</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ç±»å‹æ ‡ç­¾</label>
                    <select id="planType">
                        <option value="learning">ğŸ“š å­¦ä¹ è¾“å…¥</option>
                        <option value="exercise">ğŸƒâ€â™€ï¸ è¿åŠ¨é”»ç‚¼</option>
                        <option value="hobby">ğŸµ å…´è¶£çˆ±å¥½</option>
                        <option value="other">ğŸš— å…¶ä»–äº‹é¡¹</option>
                        <option value="goal">ğŸŒ² ç›®æ ‡è®¾å®š</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>æ€»ç»“ï¼ˆå¯é€‰ï¼‰</label>
                    <textarea id="planSummary" placeholder="è®¡åˆ’å®Œæˆåçš„æ€»ç»“..."></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-primary">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <!-- å¹´åº¦ç›®æ ‡ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="goalsModal">
        <div class="modal">
            <h2>ğŸ¯ ç¼–è¾‘ <span id="goalsModalYear">2025</span> å¹´åº¦ç›®æ ‡</h2>
            <form id="goalsForm" onsubmit="saveGoals(event)">
                <div class="form-group">
                    <label>ğŸ“š å­¦ä¹ è¾“å…¥ç›®æ ‡</label>
                    <textarea id="editGoalLearning" rows="2" placeholder="ä¾‹å¦‚ï¼šæ¯å‘¨è¯»ä¹¦3å°æ—¶ã€è‹±è¯­å­¦ä¹ ç­‰"></textarea>
                </div>
                <div class="form-group">
                    <label>ğŸƒâ€â™€ï¸ è¿åŠ¨é”»ç‚¼ç›®æ ‡</label>
                    <textarea id="editGoalExercise" rows="2" placeholder="ä¾‹å¦‚ï¼šæ¯å‘¨è¿åŠ¨2æ¬¡ã€è·‘æ­¥5å…¬é‡Œç­‰"></textarea>
                </div>
                <div class="form-group">
                    <label>ğŸµ å…´è¶£çˆ±å¥½ç›®æ ‡</label>
                    <textarea id="editGoalHobby" rows="2" placeholder="ä¾‹å¦‚ï¼šæ¯å‘¨ç»ƒä¹ 2å°æ—¶ã€å­¦ä¹ æ–°æŠ€èƒ½ç­‰"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeGoalsModal()">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-primary">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast å®¹å™¨ -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // API åŸºç¡€åœ°å€
        const API_BASE = '/api/plans';
        
        // ç¼“å­˜æ•°æ®
        let plansCache = [];
        
        // å½“å‰é€‰ä¸­çš„å¹´ä»½å’Œæœˆä»½
        let currentYear = new Date().getFullYear();
        let currentMonth = new Date().getMonth() + 1; // 1-12
        
        // å¹´åº¦ç›®æ ‡ç¼“å­˜
        let goalsCache = {};
        
        // ç±»å‹æ˜ å°„
        const TYPE_MAP = {
            'learning': { label: 'ğŸ“š å­¦ä¹ è¾“å…¥', class: 'learning' },
            'exercise': { label: 'ğŸƒâ€â™€ï¸ è¿åŠ¨é”»ç‚¼', class: 'exercise' },
            'hobby': { label: 'ğŸµ å…´è¶£çˆ±å¥½', class: 'hobby' },
            'goal': { label: 'ğŸŒ² ç›®æ ‡è®¾å®š', class: 'goal' },
            'other': { label: 'ğŸš— å…¶ä»–äº‹é¡¹', class: 'other' }
        };

        // API è¯·æ±‚å°è£…
        async function api(endpoint, method = 'GET', data = null) {
            const options = {
                method,
                headers: { 'Content-Type': 'application/json' }
            };
            if (data) options.body = JSON.stringify(data);
            
            try {
                const res = await fetch(endpoint, options);
                return await res.json();
            } catch (e) {
                console.error('API è¯·æ±‚å¤±è´¥:', e);
                showToast('âŒ ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·ç¡®ä¿æœåŠ¡å™¨å·²å¯åŠ¨', 'error');
                return null;
            }
        }

        // è·å–æ‰€æœ‰è®¡åˆ’
        async function fetchPlans() {
            const plans = await api(API_BASE);
            if (plans) plansCache = plans;
            return plansCache;
        }

        // æ ¼å¼åŒ–æ—¥æœŸæ˜¾ç¤º
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const weekDays = ['æ˜ŸæœŸæ—¥', 'æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­'];
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const weekDay = weekDays[date.getDay()];
            return `${year}å¹´${month}æœˆ${day}æ—¥ ${weekDay}`;
        }

        // æ ¹æ®æ—¥æœŸè‡ªåŠ¨è®¡ç®—æœˆä»½å’Œå‘¨
        function updateMonthWeek() {
            const dateInput = document.getElementById('planDate').value;
            if (!dateInput) return;
            
            const date = new Date(dateInput);
            
            // æ‰¾åˆ°è¯¥æ—¥æœŸæ‰€åœ¨å‘¨çš„å‘¨ä¸€
            const dayOfWeek = date.getDay(); // 0=å‘¨æ—¥, 1=å‘¨ä¸€, ..., 6=å‘¨å…­
            const mondayOffset = dayOfWeek === 0 ? -6 : 1 - dayOfWeek; // å‘¨æ—¥å¾€å‰6å¤©ï¼Œå…¶ä»–å¾€å‰åˆ°å‘¨ä¸€
            const monday = new Date(date);
            monday.setDate(date.getDate() + mondayOffset);
            
            // ç”¨å‘¨ä¸€çš„æœˆä»½ä½œä¸ºæ•´å‘¨çš„æœˆä»½
            const month = monday.getMonth() + 1; // 1-12
            document.getElementById('planMonth').value = `${month}æœˆ`;
            
            // è®¡ç®—æ˜¯è¯¥æœˆçš„ç¬¬å‡ å‘¨ï¼ˆåŸºäºå‘¨ä¸€åœ¨å½“æœˆæ˜¯ç¬¬å‡ ä¸ªå‘¨ä¸€ï¼‰
            // æ‰¾åˆ°å½“æœˆç¬¬ä¸€ä¸ªå‘¨ä¸€
            const firstDayOfMonth = new Date(monday.getFullYear(), monday.getMonth(), 1);
            const firstDayOfWeek = firstDayOfMonth.getDay(); // 0=å‘¨æ—¥, 1=å‘¨ä¸€, ...
            let firstMonday;
            if (firstDayOfWeek === 1) {
                firstMonday = 1; // 1å·å°±æ˜¯å‘¨ä¸€
            } else if (firstDayOfWeek === 0) {
                firstMonday = 2; // 1å·æ˜¯å‘¨æ—¥ï¼Œ2å·æ˜¯å‘¨ä¸€
            } else {
                firstMonday = 1 + (8 - firstDayOfWeek); // æ‰¾åˆ°ç¬¬ä¸€ä¸ªå‘¨ä¸€
            }
            
            // è®¡ç®—å½“å‰å‘¨ä¸€æ˜¯ç¬¬å‡ å‘¨
            const mondayDate = monday.getDate();
            const weekNumber = Math.floor((mondayDate - firstMonday) / 7) + 1;
            
            const weekNames = ['ç¬¬ä¸€å‘¨', 'ç¬¬äºŒå‘¨', 'ç¬¬ä¸‰å‘¨', 'ç¬¬å››å‘¨', 'ç¬¬äº”å‘¨'];
            const week = weekNames[Math.min(weekNumber - 1, 4)] || 'ç¬¬äº”å‘¨';
            document.getElementById('planWeek').value = week;
        }

        // æ¸²æŸ“è®¡åˆ’åˆ—è¡¨
        async function renderPlans() {
            const container = document.getElementById('plansContainer');
            let plans = await fetchPlans();
            if (!plans) return;

            // æ›´æ–°å¹´ä»½é€‰æ‹©å™¨
            updateYearSelector(plans);
            
            // æ›´æ–°ç­›é€‰æ¡†é€‰é¡¹ï¼ˆéœ€è¦å…ˆæ›´æ–°ï¼Œä»¥ä¾¿è·å–æ­£ç¡®çš„ç­›é€‰å€¼ï¼‰
            updateFilterOptions(plans);

            // åº”ç”¨ç­›é€‰ - é¦–å…ˆæŒ‰å¹´ä»½ç­›é€‰
            let filteredPlans = plans.filter(p => getYearFromDate(p.date) === currentYear);
            
            // åº”ç”¨å…¶ä»–ç­›é€‰æ¡ä»¶
            const filterMonth = document.getElementById('filterMonth').value;
            const filterWeek = document.getElementById('filterWeek').value;
            const filterType = document.getElementById('filterType').value;
            const filterStatus = document.getElementById('filterStatus').value;

            if (filterMonth) filteredPlans = filteredPlans.filter(p => p.month === filterMonth);
            if (filterWeek) filteredPlans = filteredPlans.filter(p => p.week === filterWeek);
            if (filterType) filteredPlans = filteredPlans.filter(p => p.type === filterType);
            if (filterStatus) {
                if (filterStatus === 'completed') filteredPlans = filteredPlans.filter(p => p.completed);
                else filteredPlans = filteredPlans.filter(p => !p.completed);
            }

            // æŒ‰æœˆä»½å’Œå‘¨åˆ†ç»„
            const grouped = {};
            filteredPlans.forEach(plan => {
                const key = `${plan.month}-${plan.week}`;
                if (!grouped[key]) {
                    grouped[key] = {
                        month: plan.month,
                        week: plan.week,
                        plans: []
                    };
                }
                grouped[key].plans.push(plan);
            });

            // æ’åºï¼ˆæ”¯æŒæ‰€æœ‰æœˆä»½ï¼‰
            const sortedGroups = Object.values(grouped).sort((a, b) => {
                // ä»æœˆä»½å­—ç¬¦ä¸²æå–æ•°å­—ï¼ˆå¦‚ "4æœˆ" -> 4ï¼‰
                const getMonthNum = (m) => parseInt(m) || 0;
                const weekOrder = { 'ç¬¬ä¸€å‘¨': 1, 'ç¬¬äºŒå‘¨': 2, 'ç¬¬ä¸‰å‘¨': 3, 'ç¬¬å››å‘¨': 4, 'ç¬¬äº”å‘¨': 5 };
                
                const monthA = getMonthNum(a.month);
                const monthB = getMonthNum(b.month);
                
                if (monthA !== monthB) {
                    return monthA - monthB;
                }
                return (weekOrder[a.week] || 0) - (weekOrder[b.week] || 0);
            });

            if (filteredPlans.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">ğŸ“­</div>
                        <h3>æš‚æ— è®¡åˆ’</h3>
                        <p>ç‚¹å‡»"æ·»åŠ è®¡åˆ’"æŒ‰é’®åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªè®¡åˆ’</p>
                    </div>
                `;
            } else {
                container.innerHTML = sortedGroups.map(group => `
                    <div class="week-group">
                        <div class="week-header">
                            <h3>${group.month} ${group.week}</h3>
                            <span class="week-stats">
                                ${group.plans.filter(p => p.completed).length}/${group.plans.length} å·²å®Œæˆ
                            </span>
                        </div>
                        <div class="plan-list">
                            ${group.plans.sort((a, b) => new Date(a.date) - new Date(b.date)).map(plan => `
                                <div class="plan-item ${plan.completed ? 'completed' : ''}" data-id="${plan.id}">
                                    <div class="checkbox-wrapper">
                                        <input type="checkbox" id="check-${plan.id}" ${plan.completed ? 'checked' : ''} 
                                            onchange="toggleComplete('${plan.id}')">
                                        <label for="check-${plan.id}">${plan.completed ? 'âœ“' : ''}</label>
                                    </div>
                                    <div class="plan-title">${plan.title}</div>
                                    <div class="plan-date">${formatDate(plan.date)}</div>
                                    <span class="type-tag ${TYPE_MAP[plan.type]?.class || 'learning'}">
                                        ${TYPE_MAP[plan.type]?.label || plan.type}
                                    </span>
                                    <div class="plan-actions">
                                        <button onclick="editPlan('${plan.id}')" title="ç¼–è¾‘">âœï¸</button>
                                        <button class="delete" onclick="deletePlan('${plan.id}')" title="åˆ é™¤">ğŸ—‘ï¸</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('');
            }

            // æ›´æ–°è®¡æ•°
            document.getElementById('planCount').textContent = `å…± ${filteredPlans.length} é¡¹`;
            
            // æ›´æ–°ç»Ÿè®¡ï¼ˆåŸºäºå½“å‰å¹´ä»½çš„æ•°æ®ï¼‰
            const yearPlans = plans.filter(p => getYearFromDate(p.date) === currentYear);
            updateStats(yearPlans);
        }

        // è·å–æ•°æ®ä¸­çš„å¹´ä»½ï¼ˆä»æ—¥æœŸå­—æ®µæå–ï¼‰
        function getYearFromDate(dateStr) {
            if (!dateStr) return null;
            const match = dateStr.match(/^(\d{4})/);
            return match ? parseInt(match[1]) : null;
        }

        // è·å–æ‰€æœ‰å¹´ä»½
        function getAllYears(plans) {
            const years = new Set();
            plans.forEach(p => {
                const year = getYearFromDate(p.date);
                if (year) years.add(year);
            });
            return [...years].sort((a, b) => a - b);
        }

        // æ›´æ–°å¹´ä»½é€‰æ‹©å™¨
        function updateYearSelector(plans) {
            const years = getAllYears(plans);
            if (years.length === 0) years.push(currentYear);
            
            // ç¡®ä¿å½“å‰å¹´ä»½åœ¨åˆ—è¡¨ä¸­
            if (!years.includes(currentYear)) {
                currentYear = years[years.length - 1]; // é€‰æ‹©æœ€æ–°å¹´ä»½
            }
            
            // æ›´æ–°å¹´ä»½æ˜¾ç¤º
            document.getElementById('currentYear').textContent = currentYear;
            document.getElementById('goalsTitle').textContent = `ğŸ¯ ${currentYear} å¹´åº¦ç›®æ ‡`;
            
            // æ›´æ–°å¹´ä»½æ ‡ç­¾
            const tabsContainer = document.getElementById('yearTabs');
            tabsContainer.innerHTML = years.map(year => 
                `<button class="year-tab ${year === currentYear ? 'active' : ''}" onclick="selectYear(${year})">${year}</button>`
            ).join('');
            
            // æ›´æ–°å¯¼èˆªæŒ‰é’®çŠ¶æ€
            const yearIndex = years.indexOf(currentYear);
            document.getElementById('prevYear').disabled = yearIndex <= 0;
            document.getElementById('nextYear').disabled = yearIndex >= years.length - 1;
        }

        // åˆ‡æ¢å¹´ä»½
        function changeYear(delta) {
            const years = getAllYears(plansCache);
            const currentIndex = years.indexOf(currentYear);
            const newIndex = currentIndex + delta;
            
            if (newIndex >= 0 && newIndex < years.length) {
                currentYear = years[newIndex];
                renderPlans();
                renderGoals();
            }
        }

        // é€‰æ‹©å¹´ä»½
        function selectYear(year) {
            currentYear = year;
            renderPlans();
            renderGoals();
        }

        // åŠ è½½å¹´åº¦ç›®æ ‡
        async function fetchGoals() {
            const goals = await api('/api/goals');
            if (goals) goalsCache = goals;
            return goalsCache;
        }

        // æ¸²æŸ“å½“å‰å¹´ä»½çš„ç›®æ ‡
        async function renderGoals() {
            if (Object.keys(goalsCache).length === 0) {
                await fetchGoals();
            }
            
            const yearGoals = goalsCache[currentYear] || {
                learning: 'ç‚¹å‡»ç¼–è¾‘è®¾ç½®ç›®æ ‡',
                exercise: 'ç‚¹å‡»ç¼–è¾‘è®¾ç½®ç›®æ ‡',
                hobby: 'ç‚¹å‡»ç¼–è¾‘è®¾ç½®ç›®æ ‡'
            };
            
            document.getElementById('goalLearning').textContent = yearGoals.learning || 'ç‚¹å‡»ç¼–è¾‘è®¾ç½®ç›®æ ‡';
            document.getElementById('goalExercise').textContent = yearGoals.exercise || 'ç‚¹å‡»ç¼–è¾‘è®¾ç½®ç›®æ ‡';
            document.getElementById('goalHobby').textContent = yearGoals.hobby || 'ç‚¹å‡»ç¼–è¾‘è®¾ç½®ç›®æ ‡';
        }

        // æ‰“å¼€ç›®æ ‡ç¼–è¾‘æ¨¡æ€æ¡†
        function openGoalsModal() {
            const yearGoals = goalsCache[currentYear] || {};
            document.getElementById('goalsModalYear').textContent = currentYear;
            document.getElementById('editGoalLearning').value = yearGoals.learning || '';
            document.getElementById('editGoalExercise').value = yearGoals.exercise || '';
            document.getElementById('editGoalHobby').value = yearGoals.hobby || '';
            document.getElementById('goalsModal').classList.add('active');
        }

        // å…³é—­ç›®æ ‡ç¼–è¾‘æ¨¡æ€æ¡†
        function closeGoalsModal() {
            document.getElementById('goalsModal').classList.remove('active');
        }

        // ä¿å­˜ç›®æ ‡
        async function saveGoals(event) {
            event.preventDefault();
            
            const goalData = {
                learning: document.getElementById('editGoalLearning').value.trim(),
                exercise: document.getElementById('editGoalExercise').value.trim(),
                hobby: document.getElementById('editGoalHobby').value.trim()
            };
            
            const result = await api(`/api/goals/${currentYear}`, 'PUT', goalData);
            if (result) {
                goalsCache[currentYear] = goalData;
                renderGoals();
                closeGoalsModal();
                showToast('âœ… å¹´åº¦ç›®æ ‡å·²ä¿å­˜', 'success');
            }
        }

        // æ˜¯å¦æ˜¯é¦–æ¬¡åŠ è½½
        let isFirstLoad = true;

        // æ›´æ–°ç­›é€‰æ¡†é€‰é¡¹ï¼ˆæ ¹æ®æ•°æ®åŠ¨æ€ç”Ÿæˆï¼Œä»…å½“å‰å¹´ä»½ï¼‰
        function updateFilterOptions(plans) {
            // è·å–å½“å‰é€‰ä¸­çš„å€¼
            let selectedMonth = document.getElementById('filterMonth').value;
            let selectedWeek = document.getElementById('filterWeek').value;
            
            // é¦–æ¬¡åŠ è½½æ—¶ï¼Œé»˜è®¤é€‰ä¸­å½“å‰æœˆä»½
            if (isFirstLoad) {
                selectedMonth = `${currentMonth}æœˆ`;
                isFirstLoad = false;
            }
            
            // åªè·å–å½“å‰å¹´ä»½çš„æ•°æ®
            const yearPlans = plans.filter(p => getYearFromDate(p.date) === currentYear);
            
            // è·å–æ‰€æœ‰å”¯ä¸€çš„æœˆä»½å’Œå‘¨
            const months = [...new Set(yearPlans.map(p => p.month).filter(m => m))];
            const weeks = [...new Set(yearPlans.map(p => p.week).filter(w => w))];
            
            // æœˆä»½æ’åºï¼ˆæŒ‰æ•°å­—ï¼‰
            months.sort((a, b) => (parseInt(a) || 0) - (parseInt(b) || 0));
            
            // å‘¨æ’åº
            const weekOrder = { 'ç¬¬ä¸€å‘¨': 1, 'ç¬¬äºŒå‘¨': 2, 'ç¬¬ä¸‰å‘¨': 3, 'ç¬¬å››å‘¨': 4, 'ç¬¬äº”å‘¨': 5 };
            weeks.sort((a, b) => (weekOrder[a] || 0) - (weekOrder[b] || 0));
            
            // å¦‚æœé€‰ä¸­çš„æœˆä»½ä¸å­˜åœ¨äºæ•°æ®ä¸­ï¼Œåˆ™æ¸…ç©ºé€‰æ‹©
            if (selectedMonth && !months.includes(selectedMonth)) {
                selectedMonth = '';
            }
            
            // æ›´æ–°æœˆä»½é€‰é¡¹
            const monthSelect = document.getElementById('filterMonth');
            monthSelect.innerHTML = '<option value="">å…¨éƒ¨</option>' + 
                months.map(m => `<option value="${m}" ${m === selectedMonth ? 'selected' : ''}>${m}</option>`).join('');
            
            // æ›´æ–°å‘¨é€‰é¡¹
            const weekSelect = document.getElementById('filterWeek');
            weekSelect.innerHTML = '<option value="">å…¨éƒ¨</option>' + 
                weeks.map(w => `<option value="${w}" ${w === selectedWeek ? 'selected' : ''}>${w}</option>`).join('');
        }

        // æ›´æ–°ç»Ÿè®¡
        function updateStats(plans) {
            const total = plans.length;
            const completed = plans.filter(p => p.completed).length;
            const rate = total > 0 ? Math.round((completed / total) * 100) : 0;

            document.getElementById('totalPlans').textContent = total;
            document.getElementById('completedPlans').textContent = completed;
            document.getElementById('completionRate').textContent = rate + '%';
            document.getElementById('progressFill').style.width = rate + '%';

            document.getElementById('learningCount').textContent = plans.filter(p => p.type === 'learning').length;
            document.getElementById('exerciseCount').textContent = plans.filter(p => p.type === 'exercise').length;
            document.getElementById('hobbyCount').textContent = plans.filter(p => p.type === 'hobby').length;
        }

        // åˆ‡æ¢å®ŒæˆçŠ¶æ€
        async function toggleComplete(id) {
            const result = await api(`${API_BASE}/${id}`, 'PATCH');
            if (result) {
                showToast(result.completed ? 'âœ… å·²å®Œæˆ' : 'â³ æ ‡è®°ä¸ºæœªå®Œæˆ', 'success');
                renderPlans();
            }
        }

        // æ‰“å¼€æ·»åŠ æ¨¡æ€æ¡†
        function openAddModal() {
            document.getElementById('modalTitle').textContent = 'â• æ·»åŠ æ–°è®¡åˆ’';
            document.getElementById('planForm').reset();
            document.getElementById('planId').value = '';
            document.getElementById('planDate').value = new Date().toISOString().split('T')[0];
            updateMonthWeek(); // è‡ªåŠ¨è®¡ç®—æœˆä»½å’Œå‘¨
            document.getElementById('planModal').classList.add('active');
        }

        // ç¼–è¾‘è®¡åˆ’
        async function editPlan(id) {
            const plan = plansCache.find(p => p.id == id);
            if (plan) {
                document.getElementById('modalTitle').textContent = 'âœï¸ ç¼–è¾‘è®¡åˆ’';
                document.getElementById('planId').value = plan.id;
                document.getElementById('planTitle').value = plan.title;
                document.getElementById('planDate').value = plan.date;
                document.getElementById('planMonth').value = plan.month;
                document.getElementById('planWeek').value = plan.week;
                document.getElementById('planType').value = plan.type;
                document.getElementById('planSummary').value = plan.summary || '';
                document.getElementById('planModal').classList.add('active');
            }
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            document.getElementById('planModal').classList.remove('active');
        }

        // ä¿å­˜è®¡åˆ’
        async function savePlan(event) {
            event.preventDefault();
            const id = document.getElementById('planId').value;
            
            const planData = {
                title: document.getElementById('planTitle').value,
                date: document.getElementById('planDate').value,
                month: document.getElementById('planMonth').value,
                week: document.getElementById('planWeek').value,
                type: document.getElementById('planType').value,
                summary: document.getElementById('planSummary').value
            };

            let result;
            if (id) {
                // ç¼–è¾‘
                result = await api(`${API_BASE}/${id}`, 'PUT', planData);
                if (result) showToast('âœ… è®¡åˆ’å·²æ›´æ–°', 'success');
            } else {
                // æ–°å¢
                result = await api(API_BASE, 'POST', planData);
                if (result) showToast('âœ… è®¡åˆ’å·²æ·»åŠ ', 'success');
            }

            if (result) {
                closeModal();
                renderPlans();
            }
        }

        // åˆ é™¤è®¡åˆ’
        async function deletePlan(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè®¡åˆ’å—ï¼Ÿ')) {
                const result = await api(`${API_BASE}/${id}`, 'DELETE');
                if (result) {
                    showToast('ğŸ—‘ï¸ è®¡åˆ’å·²åˆ é™¤', 'success');
                    renderPlans();
                }
            }
        }

        // å¯¼å‡ºæ•°æ®
        async function exportData() {
            const plans = await fetchPlans();
            if (!plans) return;
            
            const dataStr = JSON.stringify(plans, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `schedule_backup_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('ğŸ“¥ æ•°æ®å·²å¯¼å‡º', 'success');
        }

        // å¯¼å…¥æ•°æ®
        async function importData(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = async function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (Array.isArray(data)) {
                            if (confirm(`ç¡®å®šè¦å¯¼å…¥ ${data.length} æ¡è®¡åˆ’å—ï¼Ÿè¿™å°†è¦†ç›–ç°æœ‰æ•°æ®ã€‚`)) {
                                const result = await api(API_BASE, 'PUT', data);
                                if (result) {
                                    showToast('ğŸ“¤ æ•°æ®å·²å¯¼å…¥', 'success');
                                    renderPlans();
                                }
                            }
                        } else {
                            showToast('âŒ æ–‡ä»¶æ ¼å¼é”™è¯¯', 'error');
                        }
                    } catch (err) {
                        showToast('âŒ æ–‡ä»¶è§£æå¤±è´¥', 'error');
                    }
                };
                reader.readAsText(file);
            }
            event.target.value = '';
        }

        // æ˜¾ç¤ºæç¤º
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            container.appendChild(toast);
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // ç­›é€‰äº‹ä»¶
        document.getElementById('filterMonth').addEventListener('change', renderPlans);
        document.getElementById('filterWeek').addEventListener('change', renderPlans);
        document.getElementById('filterType').addEventListener('change', renderPlans);
        document.getElementById('filterStatus').addEventListener('change', renderPlans);

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        document.getElementById('planModal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });
        document.getElementById('goalsModal').addEventListener('click', function(e) {
            if (e.target === this) closeGoalsModal();
        });

        // ESC å…³é—­æ¨¡æ€æ¡†
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
                closeGoalsModal();
            }
        });

        // åˆå§‹åŒ–
        async function init() {
            await fetchGoals();
            await renderPlans();
            renderGoals();
        }
        init();
    </script>
</body>
</html>

